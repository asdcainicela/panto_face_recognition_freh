# ============================================================================
# PANTO FACE RECOGNITION - 1080p con ROI
# CONFIGURACIÓN RECOMENDADA ✅
# ============================================================================
# 
# Escenario: Cámara en puerta de entrada con zoom
# Resolución: 1920x1080 (1080p) + ROI 50%
# Performance esperado: 22-25 FPS, precisión 94-97%
# GPU mínima: GTX 1650 / RTX 2060 Mobile
#
# ============================================================================

[project]
name = "panto_door_access_1080p_roi"
version = "1.0.0"
scenario = "entrance_door_1080p"

[camera]
resolution = [1920, 1080]
fps_target = 25
device_id = 0
backend = "gstreamer"
buffer_size = 1
drop_old_frames = true

# ROI activado = "zoom 2x" en zona de puerta
[camera.roi]
enabled = true
x = 480
y = 270
width = 960
height = 540

[detection]
model = "retinaface"
model_path = "models/retinaface_mobilenet.onnx"
backend = "onnx"
use_gpu = true
num_threads = 4
min_face_size = 60
confidence_threshold = 0.65
nms_threshold = 0.4

[tracking]
algorithm = "bytetrack"
use_gpu = false
max_tracks = 5
max_age = 30
min_hits = 3
direction_filter = "approaching"
ignore_leaving = true
min_movement = 5

[superresolution]
enabled = true
conditional_threshold = 80  # Solo si rostro < 80px
model = "realesr_x2"
model_path = "models/realesr_x2.onnx"
target_size = 224
use_gpu = true
skip_if_sharp = true
sharpness_threshold = 0.7
max_sr_per_second = 10
batch_size = 1

[recognition]
model = "arcface_r100"
model_path = "models/arcface_r100.onnx"
backend = "onnx"
use_gpu = true
embedding_size = 512
strategy = "multi_frame_voting"
voting_method = "weighted_average"
min_frames = 10
alignment_method = "similarity"
normalize_embeddings = true
min_face_size_for_match = 80
confidence_threshold = 0.35
min_face_quality = 0.5
max_face_angle = 45

# ============================================================================
# ZONAS - Adaptadas para 1080p con ROI
# ============================================================================
# Con ROI (960x540): 10 dedos = 960px
# Cabeza más cerca: 1 dedo = 96px → rostro ~67px (pero con ROI = 134px efectivo)
# Cabeza más lejos: 1/3 dedo = 32px → rostro ~22px (pero con ROI = 44px efectivo)
# El ROI duplica el tamaño efectivo

[zones]
enabled = true
draw_zones = false

# ZONA 1: Lejos (60-100px) - Tracking + SR
[zones.far]
min_face_size = 60
max_face_size = 100
action = "track_and_accumulate"
apply_sr = true
priority = "low"
confidence_threshold = 0.50
frame_weight = 0.3

# ZONA 2: Óptima (100-200px) - DECIDIR ⭐
[zones.optimal]
min_face_size = 100
max_face_size = 200
action = "definitive_match"
apply_sr = false
priority = "high"
confidence_threshold = 0.35
frame_weight = 1.0
trigger_decision = true

# ZONA 3: Muy cerca (>200px) - Verificación
[zones.close]
min_face_size = 200
action = "verify_and_log"
apply_sr = false
priority = "critical"
confidence_threshold = 0.30
frame_weight = 1.0

[matching]
database_path = "data/known_faces.db"
database_type = "sqlite"
distance_metric = "cosine"
adaptive_threshold = true
unknown_person_threshold = 0.60
frame_weight_by_size = true
frame_weight_by_quality = true

[actions]
log_access_events = true
access_log_path = "logs/access_events.db"
save_best_frame = true
save_all_frames = false
frames_path = "data/captures/{date}/{person_id}"
image_format = "jpg"
image_quality = 90

[actions.webhook]
enabled = false
url = "http://192.168.1.10:5000/access"
method = "POST"
timeout = 5
on_match = true
on_unknown = false

[actions.mqtt]
enabled = false
broker = "192.168.1.10"
port = 1883
topic_prefix = "panto/access"
qos = 1

[output]
display_output = true
output_resolution = "input"
window_name = "Panto Access Control 1080p"
draw_detections = true
draw_tracks = true
draw_zones = false
draw_roi = true
draw_ids = true
draw_confidence = true
draw_fps = true

colors = {
    known = [0, 255, 0],
    unknown = [0, 0, 255],
    tracking = [255, 255, 0],
    roi = [255, 0, 255]
}

[output.video]
enabled = false
output_path = "recordings/{date}.mp4"
codec = "mp4v"
fps = 25

[database]
path = "data/panto.db"
auto_vacuum = true
journal_mode = "WAL"
auto_backup = true
backup_interval = 86400
backup_path = "backups/panto_{date}.db"
retention_days = 90
cleanup_on_startup = true

[performance]
use_tensorrt = false
use_openvino = false
use_coreml = false
detector_threads = 2
recognition_threads = 2
sr_threads = 1
io_threads = 1
max_queue_size = 30
clear_queue_on_full = true
embedding_cache_size = 1000
enable_motion_detection = false
motion_threshold = 0.05
sleep_after_seconds = 60

[logging]
level = "INFO"
log_to_file = true
log_to_console = true
log_path = "logs/panto_{date}.log"
rotate_logs = true
max_log_size_mb = 10
backup_count = 5
log_detections = false
log_trackings = false
log_recognitions = true
log_performance = true

[debug]
enabled = false
save_debug_images = false
debug_path = "debug/{date}"
profile_performance = false
verbose_logging = false